<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base
  -->
  <base href="/beyondHorizonCalc/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A horizon visibility calculator to show how much of a distant object is hidden by Earth's curvature">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Beyond Horizon Calculator">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Beyond Horizon Calculator</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // The service worker version
    var serviceWorkerVersion = null;
    
    // Add error handling for script loading
    window.addEventListener('error', function(e) {
      console.error('Script loading error:', e);
    });
  </script>
</head>
<body>
  <script>
    // Check if files exist before loading
    function checkResource(url) {
      return fetch(url)
        .then(response => {
          if (!response.ok) throw new Error(`Failed to load ${url}`);
          return true;
        })
        .catch(error => {
          console.error(error);
          return false;
        });
    }

    async function initializeFlutter() {
      try {
        const flutterExists = await checkResource('flutter.js');
        if (!flutterExists) {
          throw new Error('Flutter.js not found');
        }

        // Load flutter.js
        const flutterScript = document.createElement('script');
        flutterScript.src = 'flutter.js';
        flutterScript.defer = true;
        document.body.appendChild(flutterScript);

        flutterScript.onload = function() {
          // Now load flutter_bootstrap.js
          const bootstrapScript = document.createElement('script');
          bootstrapScript.src = 'flutter_bootstrap.js';
          bootstrapScript.defer = true;
          document.body.appendChild(bootstrapScript);

          // Initialize Flutter
          window.addEventListener('load', function() {
            if (window._flutter) {
              window._flutter.loader.loadEntrypoint({
                serviceWorker: {
                  serviceWorkerVersion: serviceWorkerVersion,
                },
                onEntrypointLoaded: async function(engineInitializer) {
                  try {
                    const appRunner = await engineInitializer.initializeEngine();
                    await appRunner.runApp();
                  } catch (error) {
                    console.error('Error initializing Flutter app:', error);
                  }
                }
              });
            } else {
              console.error('Flutter initialization failed: _flutter not defined');
            }
          });
        };
      } catch (error) {
        console.error('Error during Flutter initialization:', error);
      }
    }

    // Start initialization
    initializeFlutter();
  </script>
</body>
</html>
